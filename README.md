# CalcAny - 数据分析可视化工具

[![Python](https://img.shields.io/badge/Python-3.12-blue.svg)](https://www.python.org/)
[![Tkinter](https://img.shields.io/badge/GUI-Tkinter-green.svg)](https://docs.python.org/3/library/tkinter.html)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Windows-lightgrey.svg)](https://www.microsoft.com/windows)

一个基于Python的桌面数据分析可视化工具，专门用于处理和分析层级结构的JSON数据。通过直观的图形界面，帮助用户快速理解和分析复杂的数据结构。

## ✨ 主要特性

- 🔍 **智能数据导入** - 支持JSON格式数据文件的导入和解析
- 📊 **多维度数据展示** - 支持层级数据的可视化展示（整体/BOQ/模型/部件）
- 🔧 **可配置界面** - 通过配置文件自定义显示字段和中文名称
- 🔎 **实时搜索过滤** - 支持对数据表格内容进行实时搜索和过滤
- 📋 **数据复制功能** - 支持复制整行数据为文本、JSON格式和Markdown表格格式
- 🎨 **现代化UI** - 基于Tkinter的现代化界面设计，支持微软雅黑字体
- 📈 **内存优化** - 内置内存监控和优化机制，支持大数据集处理
- 🔢 **高精度数值处理** - 自动将数字类型转换为decimal类型，确保数值计算的高精度
- 📝 **完整日志** - 详细的日志记录系统，便于问题排查
- ⚙️ **可视化配置管理** - 图形化配置管理界面，支持配置导入导出
- 🛠️ **模块化架构** - 采用工具模块设计，提供通用的验证、数据处理和剪贴板工具
- 🔧 **代码重构优化** - 经过全面重构，消除重复代码，提高可维护性

## 🌟 核心亮点

### 🎯 专业数据分析
- ✅ **层级数据处理** - 专门针对复杂JSON结构设计，支持多层级数据展示
- ✅ **智能字段映射** - 自动识别数据字段，支持中文名称映射
- ✅ **实时数据过滤** - 100ms极速响应，支持大数据集实时搜索
- ✅ **高精度数值计算** - 自动将数字类型转换为decimal类型，避免浮点数精度丢失
- ✅ **多格式导出** - 一键复制为文本、JSON、Markdown三种格式

### 🚀 用户体验优化
- ✅ **现代化界面** - 基于微软雅黑字体的现代化UI设计
- ✅ **智能布局** - 响应式界面布局，支持窗口大小调整
- ✅ **操作便捷** - 右键菜单、双击复制等人性化交互
- ✅ **配置灵活** - 可视化配置管理，支持个性化定制

### 💪 技术优势
- ✅ **模块化架构** - MVC设计模式，代码结构清晰易维护
- ✅ **性能优化** - 内存监控、增量更新、智能缓存
- ✅ **跨平台支持** - 基于Python + Tkinter，支持Windows/Linux/macOS
- ✅ **完整日志** - 详细的操作日志，便于问题排查和功能验证

## 🖼️ 界面预览

### 📱 主界面布局
```
┌─────────────────────────────────────────────────────────────┐
│  📋 CalcAny - 数据分析可视化工具                              │
├─────────────────────────────────────────────────────────────┤
│  📁 文件  🔧 工具  ❓ 帮助                                    │
├─────────────────────────────────────────────────────────────┤
│  📊 文档基本信息区域 (6列网格布局)                            │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐ │
│  │ 字段1   │ 字段2   │ 字段3   │ 字段4   │ 字段5   │ 字段6   │ │
│  └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘ │
├─────────────────────────────────────────────────────────────┤
│  📑 因子分类选项卡                                            │
│  ┌─基础因子─┬─高级因子─┬─自定义因子─┐                          │
│  │          │          │            │                          │
│  └──────────┴──────────┴────────────┘                          │
├─────────────────────────────────────────────────────────────┤
│  🔘 数据层级: ○整体 ○BOQ ○模型 ●部件    🔍 [实时搜索框]      │
├─────────────────────────────────────────────────────────────┤
│  📋 数据表格区域 (支持排序、复制、右键菜单)                   │
│  ┌─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐ │
│  │ 列1 ↕   │ 列2 ↕   │ 列3 ↕   │ 列4 ↕   │ 列5 ↕   │ 列6 ↕   │ │
│  ├─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤ │
│  │ 数据1   │ 数据2   │ 数据3   │ 数据4   │ 数据5   │ 数据6   │ │
│  │ 数据1   │ 数据2   │ 数据3   │ 数据4   │ 数据5   │ 数据6   │ │
│  └─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 🎛️ 功能模块
- **📊 数据层次选择** - 单选按钮切换不同数据层级视图
- **🔍 实时搜索过滤** - 支持全字段模糊搜索，100ms极速响应
- **📋 右键菜单** - 复制文本/JSON/Markdown，支持单元格和整行操作
- **⚙️ 配置管理** - 可视化界面管理显示字段和中文名称映射

## 🚀 快速开始

### 环境要求

- Python 3.8+
- Windows 7/8/10/11 (64位)
- 至少 4GB 内存
- 100MB 可用磁盘空间

### 安装依赖

```bash
pip install -r requirements.txt
```

或手动安装核心依赖：
```bash
pip install pandas>=1.5.0 psutil>=5.9.0 tksheet>=7.0.0
```

### 运行程序

```bash
python main.py
```

### 使用可执行文件

如果您有打包好的可执行文件：

1. 双击 `CalcAny.exe` 或运行 `运行CalcAny.bat`
2. 如被杀毒软件拦截，请添加到信任列表
3. 程序会自动创建配置文件和日志目录

## 📁 项目结构

```
data_analysis/
├── main.py                 # 程序入口文件
├── config_manager_ui.py   # 配置管理界面
├── config.json            # 配置文件
├── config_template.json   # 配置模板
├── sample.json            # 示例数据
├── requirements.txt       # 依赖包列表
├── version_info.txt       # 版本信息
├── calc_any.spec          # PyInstaller打包配置
├── controllers/           # 控制器模块
│   ├── app_controller.py  # 主应用逻辑控制
│   └── logging_setup.py   # 日志配置管理
├── models/                # 数据模型层
│   ├── config_manager.py  # 配置管理器
│   └── data_manager.py    # 数据管理器
├── views/                 # 视图层
│   ├── main_app_view.py   # 主界面视图
│   ├── document_info_view.py # 文档信息视图
│   ├── factor_view.py     # 因子分类视图
│   └── sub_factor_detail_view.py # 子因子详情视图
├── utils/                 # 工具层
│   ├── validation_utils.py # 数据验证工具
│   ├── data_utils.py      # 数据处理工具
│   ├── clipboard_utils.py # 剪贴板操作工具
│   └── logging_utils.py   # 日志管理工具
└── logs/                  # 日志目录（自动创建）
```

## ⚙️ 配置说明

### 配置文件结构 (config.json)

```json
{
  "document_info_fields": ["businessCode", "netSalesRevenue"],
  "data_hierarchy_names": {
    "total": "整体",
    "boq": "BOQ",
    "model": "模型",
    "part": "部件"
  },
  "factor_categories": {
    "基础因子": [
      {
        "name": "收入因子",
        "basic_info": ["businessCode", "netSalesRevenue"],
        "table_info": {
          "total": ["netSalesRevenue", "listPriceTotalOutHardware"]
        }
      }
    ]
  },
  "display_names": {
    "netSalesRevenue": "净销售收入",
    "businessCode": "业务代码"
  }
}
```

### 配置管理

程序提供可视化配置管理界面：

1. 菜单栏 → 工具 → 配置管理
2. 支持配置编辑、导入、导出和重置
3. 配置更改后自动刷新程序设置

### 核心模块说明

- **controllers/** - 控制器层，处理业务逻辑和应用流程
- **models/** - 数据模型层，管理配置和数据处理
- **views/** - 视图层，实现GUI界面和用户交互
- **utils/** - 工具层，提供通用的验证、数据处理和剪贴板工具

## 📊 数据格式

### 输入数据要求

- **格式**: JSON文件
- **结构**: 包含 `calculateItemVO` 字段的层级数据
- **编码**: UTF-8

### 示例数据结构

```json
{
  "businessCode": "BIZ001",
  "netSalesRevenue": 1000000,
  "calculateItemVO": {
    "total": {
      "netSalesRevenue": 1000000,
      "children": [
        {
          "level": "boq",
          "data": {...}
        }
      ]
    }
  }
}
```

## 💡 功能使用说明

### 🚀 快速开始

1. **启动程序**: 运行 `python main.py` 或双击可执行文件
2. **导入数据**: 通过菜单栏选择JSON数据文件
3. **浏览数据**: 使用层级选择和因子分类查看不同维度的数据
4. **搜索过滤**: 在搜索框中输入关键词实时过滤表格数据
5. **复制导出**: 使用右键菜单复制所需格式的数据

### 📊 界面功能详解

#### 主界面布局
- **顶部菜单栏**: 文件操作、工具配置、帮助信息
- **文档信息区**: 显示JSON文件的基本信息，支持字段值复制
- **因子分类区**: 选项卡形式展示不同类别的因子
- **数据层级区**: 单选按钮切换数据展示层级（整体/BOQ/模型/部件）
- **搜索过滤区**: 实时搜索框，支持100ms极速响应
- **数据表格区**: 主要数据展示区域，支持排序和复制功能

#### 数据复制功能

**表格右键菜单**（在数据表格中右键点击任意行）：
- 🔤 **复制行 (文本)** - 制表符分隔的纯文本格式，适合粘贴到Excel
- 📋 **复制行 (JSON)** - 标准JSON格式，便于程序间数据交换
- 📝 **复制行 (Markdown)** - 包含表头的Markdown表格，适用于文档和Wiki

**单元格操作**：
- 🖱️ **双击单元格** - 快速复制单个单元格的值到剪贴板
- 📄 **右键字段值** - 在基本信息区域右键复制字段内容

**使用场景**：
- 📊 **Excel分析**: 使用文本格式复制，直接粘贴到Excel进行进一步分析
- 🔧 **API开发**: 使用JSON格式复制，用于接口测试和数据交换
- 📖 **文档编写**: 使用Markdown格式复制，快速生成技术文档表格
- 📈 **报告制作**: 复制特定数据行，制作专业的数据报告

### 🔍 高级功能

#### 实时搜索过滤
- ⚡ **极速响应**: 100毫秒延迟，近乎实时的搜索体验
- 🔎 **全字段搜索**: 支持对表格所有字段进行模糊匹配
- 🎯 **智能过滤**: 自动高亮匹配结果，支持中英文搜索

#### 配置管理
- ⚙️ **可视化配置**: 通过菜单栏"工具" -> "⚙️ 配置管理"访问图形界面
- 📋 **全面管理**: 支持单据信息字段、数据层次、因子分类和显示名称的统一配置
- 📤 **配置导入导出**: 支持配置文件的备份和共享
- 🔄 **动态更新**: 配置更改后无需重启即可生效
- 🪟 **独立窗口**: 配置管理器作为独立窗口运行，不影响主程序功能

#### 数据层级展示
- 📈 **多维度视图**: 支持整体、BOQ、模型、部件四个层级
- 🔗 **层级关联**: 自动展示上下级数据关系
- 📊 **智能聚合**: 根据层级自动计算汇总数据

## 🔧 技术架构

### 🛠️ 技术栈

| 组件 | 技术选型 | 版本要求 | 说明 |
|------|----------|----------|------|
| **核心语言** | Python | 3.8+ | 主要开发语言 |
| **GUI框架** | Tkinter + tksheet | 内置 + >=7.0.0 | 跨平台桌面应用界面 |
| **数据处理** | Pandas | >=1.5.0 | 高性能数据分析库 |
| **高精度计算** | Python decimal | 内置 | 高精度数值计算，避免浮点数误差 |
| **系统监控** | psutil | >=5.9.0 | 内存和性能监控 |
| **日志系统** | Python logging | 内置 | 完整的日志记录 |
| **打包工具** | PyInstaller | >=6.0.0 (可选) | 可执行文件打包 |

### 🏗️ 架构设计

```
┌─────────────────────────────────────────────────────────────┐
│                        CalcAny 架构图                        │
├─────────────────────────────────────────────────────────────┤
│  main.py (应用入口)                                          │
├─────────────────────────────────────────────────────────────┤
│  Controllers/ (控制器层)                                     │
│  ├── app_controller.py     # 主应用逻辑控制                  │
│  └── logging_setup.py      # 日志配置管理                   │
├─────────────────────────────────────────────────────────────┤
│  Views/ (视图层)                                            │
│  ├── main_app_view.py      # 主界面视图                     │
│  ├── document_info_view.py # 文档信息视图                   │
│  ├── factor_view.py        # 因子分类视图                   │
│  └── sub_factor_detail_view.py # 子因子详情视图             │
├─────────────────────────────────────────────────────────────┤
│  Models/ (数据模型层)                                        │
│  ├── config_manager.py     # 配置管理器                     │
│  └── data_manager.py       # 数据管理器                     │
├─────────────────────────────────────────────────────────────┤
│  Utils/ (工具层)                                            │
│  ├── validation_utils.py   # 数据验证工具                   │
│  ├── data_utils.py         # 数据处理工具                   │
│  ├── lightweight_data.py   # 轻量级数据处理和decimal转换    │
│  ├── clipboard_utils.py    # 剪贴板操作工具                 │
│  └── logging_utils.py      # 日志管理工具                   │
└─────────────────────────────────────────────────────────────┘
```

### ⚡ 性能优化

- **🚀 极速搜索**: 50ms响应时间，支持大数据集实时过滤
- **💾 内存优化**: 智能缓存机制，自动垃圾回收，支持大文件处理
- **🔄 增量更新**: 表格数据增量刷新，避免全量重绘
- **📊 分块处理**: 大数据集分批加载，保证界面响应性

### 📦 打包部署

**开发环境运行**:
```bash
# 安装依赖
pip install -r requirements.txt

# 启动应用
python main.py
```

**生产环境打包**:
```bash
# 使用PyInstaller打包
pyinstaller calc_any.spec

# 生成的可执行文件位于 dist/ 目录
```

## 🐛 故障排除

### ❓ 常见问题解决

<details>
<summary>🚫 程序无法启动</summary>

**可能原因及解决方案**:
- ✅ **Python版本**: 确保使用Python 3.8+版本
- ✅ **依赖安装**: 运行 `pip install -r requirements.txt`
- ✅ **权限问题**: 以管理员身份运行或检查文件权限
- ✅ **日志检查**: 查看 `logs/app_YYYYMMDD.log` 获取详细错误信息

```bash
# 检查Python版本
python --version

# 重新安装依赖
pip install --upgrade -r requirements.txt
```
</details>

<details>
<summary>📄 数据加载失败</summary>

**数据文件要求**:
- ✅ **文件格式**: 必须是有效的JSON文件
- ✅ **文件编码**: UTF-8编码
- ✅ **数据结构**: 包含 `calculateItemVO` 字段
- ✅ **文件大小**: 建议小于100MB以获得最佳性能

**验证数据格式**:
```bash
# 使用Python验证JSON格式
python -c "import json; print('Valid JSON' if json.load(open('your_file.json', 'r', encoding='utf-8')) else 'Invalid JSON')"
```
</details>

<details>
<summary>⚙️ 配置文件问题</summary>

**配置修复步骤**:
1. 打开程序 → 工具 → 配置管理
2. 点击"重置为默认配置"
3. 或手动编辑 `config.json`，参考 `config_template.json`

**配置文件位置**: `./config.json`
</details>

<details>
<summary>📊 表格显示异常</summary>

**检查清单**:
- ✅ 确认 `display_names` 配置正确
- ✅ 验证 `table_info` 字段名存在于数据中
- ✅ 检查字段名大小写是否匹配
- ✅ 重启程序应用新配置
</details>

<details>
<summary>💾 性能和内存问题</summary>

**优化建议**:
- 🔄 **大文件处理**: 分批导入，避免一次性加载过大文件
- 🧹 **内存清理**: 程序内置自动垃圾回收机制
- 📊 **监控工具**: 使用任务管理器监控内存使用情况
- ⚡ **搜索优化**: 避免过于频繁的搜索操作
</details>

### 📋 日志系统

**日志文件位置**: `logs/app_YYYYMMDD.log`

**日志级别说明**:
- 🔍 **DEBUG**: 详细的调试信息
- ℹ️ **INFO**: 一般操作信息
- ⚠️ **WARNING**: 警告信息
- ❌ **ERROR**: 错误信息

**查看实时日志**:
```bash
# 使用记事本打开日志文件
notepad logs/app_20250122.log

# 或使用PowerShell查看日志末尾
Get-Content logs/app_20250122.log -Tail 50
```

## 🚀 后续功能预告

我们正在积极开发更多实用功能，敬请期待！

### 📅 近期规划 (v1.3.x)

<details>
<summary>🎨 界面增强</summary>

- **🌙 深色主题**: 支持深色/浅色主题切换，保护眼睛
- **📐 自定义布局**: 可调整面板大小，个性化工作区
- **🎯 快捷键支持**: 添加常用操作的键盘快捷键
- **📱 响应式设计**: 优化不同分辨率下的显示效果
</details>

<details>
<summary>📊 数据处理增强</summary>

- **📈 数据可视化**: 内置图表生成，支持柱状图、折线图、饼图
- **🔄 批量操作**: 支持批量导入、导出、转换多个文件
- **🔍 高级搜索**: 正则表达式搜索、多条件组合搜索
- **📋 数据对比**: 支持两个数据集的差异对比分析
</details>

<details>
<summary>🛠️ 功能扩展</summary>

- **🔌 插件系统**: 支持第三方插件，扩展自定义功能
- **☁️ 云端同步**: 配置和数据的云端备份与同步
- **📤 多格式导出**: 支持Excel、CSV、PDF等多种格式导出
- **🔔 智能提醒**: 数据异常检测和智能提醒功能
</details>

## 🚀 未来功能模块

### 📋 即将推出的核心功能

<details>
<summary>⚙️ 配置页面增强</summary>

- **🎛️ 可视化配置界面**: 提供直观的GUI界面管理config.json配置
- **🔧 实时配置预览**: 配置修改后即时预览效果，无需重启应用
- **📝 配置验证**: 智能验证配置项的有效性和完整性
- **💾 配置备份**: 自动备份配置历史，支持一键恢复
- **🎨 主题定制**: 支持界面主题、字体、颜色等个性化设置
</details>

<details>
<summary>🌐 API数据源支持</summary>

- **🔌 RESTful API集成**: 支持通过HTTP API接口加载外部数据
- **🔐 认证机制**: 支持API Key、OAuth2.0等多种认证方式
- **⚡ 异步数据加载**: 非阻塞式数据获取，提升用户体验
- **🔄 数据同步**: 定时或手动同步外部数据源
- **📊 数据格式适配**: 自动适配JSON、XML等多种数据格式
</details>

<details>
<summary>👁️ 外部接口数据查看</summary>

- **📡 接口监控面板**: 实时监控API接口状态和响应时间
- **📈 数据流可视化**: 图表展示数据获取和处理流程
- **🔍 接口调试工具**: 内置API测试工具，支持参数调试
- **📋 响应数据预览**: 格式化显示API返回的原始数据
- **⚠️ 异常处理**: 智能处理网络异常和数据格式错误
</details>

<details>
<summary>🔍 数据对比功能</summary>

- **📊 多维度对比**: 支持按时间、版本、来源等维度对比数据
- **🎯 差异高亮**: 智能标识数据差异，支持颜色编码
- **📈 对比报告**: 自动生成详细的数据对比分析报告
- **💾 对比历史**: 保存对比结果，支持历史对比查看
- **📤 结果导出**: 支持将对比结果导出为Excel、PDF等格式
</details>

### 🛠️ 技术架构升级

- **🏗️ 模块化架构**: 采用插件化设计，支持功能模块独立开发和部署
- **⚡ 性能优化**: 引入缓存机制和数据分页，提升大数据处理能力
- **🔒 安全增强**: 加强数据加密和访问控制，确保数据安全
- **🌐 跨平台支持**: 扩展对macOS和Linux系统的原生支持

### 📅 开发时间规划

| 功能模块 | 预计开发时间 | 优先级 | 状态 |
|---------|-------------|--------|------|
| 配置页面增强 | 2-3周 | 🔴 高 | 📋 规划中 |
| API数据源支持 | 3-4周 | 🔴 高 | 📋 规划中 |
| 外部接口数据查看 | 2-3周 | 🟡 中 | 📋 规划中 |
| 数据对比功能 | 4-5周 | 🟡 中 | 📋 规划中 |
| 技术架构升级 | 持续进行 | 🔴 高 | 📋 规划中 |

### 🎯 长期愿景 (v2.0+)

- **🤖 AI辅助分析**: 集成机器学习算法，提供智能数据分析建议
- **🌐 Web版本**: 基于浏览器的在线版本，随时随地访问
- **👥 协作功能**: 多人协作编辑，实时同步数据变更
- **📊 报表生成**: 自动生成专业的数据分析报表
- **🔗 API接口**: 提供RESTful API，支持第三方系统集成

### 💡 功能建议

我们非常重视用户反馈！如果您有好的想法或建议，请：

- 📝 在 [Issues](../../issues) 中提交功能请求
- 💬 参与 [Discussions](../../discussions) 讨论
- ⭐ 为喜欢的功能建议点赞投票

**开发进度**: 您可以在 [Projects](../../projects) 页面查看详细的开发进度和里程碑

---

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 👥 开发团队

- **CalcAny Development Team** - *初始开发* 

## 📞 联系我们

如有问题或建议，请：

- 提交 [Issue](../../issues)
- 查看详细的开发文档 `development_plan.md`
- 检查日志文件进行问题排查

---

**注意**: 这是一个合法的数据分析工具，如果可执行文件被杀毒软件误报，请添加到信任列表中。程序不会收集或传输任何个人数据，所有数据处理均在本地完成。
