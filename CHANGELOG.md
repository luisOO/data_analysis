# 更新日志

## [v1.2.13] - 2025-01-22

### ✨ 新增功能

#### 集成配置管理模块到主程序
- **新增内容**: 
  - 在主程序菜单栏添加"工具" -> "⚙️ 配置管理"选项
  - 集成完整的配置管理界面，支持可视化配置编辑
  - 支持单据信息字段、数据层次、因子分类和显示名称的统一管理
- **技术实现**:
  - 在`MainAppView`类中添加`create_menu`方法，创建完整的菜单栏
  - 添加`open_config_manager`方法，集成`ConfigManagerUI`组件
  - 修复`ConfigManagerUI`初始化参数问题，确保正确集成
  - 配置管理器作为独立窗口运行，不影响主程序功能
- **用户体验**: 用户可以通过主程序菜单方便地访问所有配置功能，提升配置管理的便捷性
- **影响范围**: 主程序菜单栏和配置管理功能

### 🔧 代码优化

#### 清理测试和调试代码
- **优化内容**: 
  - 删除所有临时测试文件和调试脚本
  - 保持项目目录整洁，只保留核心功能代码
  - 移除不再需要的测试集成脚本
- **清理文件**: 
  - `test_main_integration.py` - 主程序集成测试
  - `test_config_integration.py` - 配置集成测试
  - `integration_verification.py` - 集成验证脚本
  - `test_config_enhancement.py` - 配置增强测试
  - `test_new_config_ui.py` - 新配置UI测试
  - `debug_config_ui.py` - 配置UI调试脚本
  - `final_test_config_ui.py` - 最终配置UI测试
- **影响范围**: 项目文件结构和代码维护性

## [v1.2.12] - 2025-01-22

### 🐛 问题修复

#### 修复配置文件字段顺序与页面展示不一致问题
- **修复内容**: 
  - 解决配置文件中`basic_info`字段顺序与页面实际显示顺序不一致的问题
  - 修复页面使用硬编码优先级排序，忽略配置文件字段顺序的问题
- **技术实现**:
  - 调整config.json中两个因子的`basic_info`字段顺序，遵循页面展示优先级
  - 修改`SubFactorDetailView`类的`display_basic_info`方法，移除硬编码优先级
  - 改为从配置文件动态获取字段顺序，确保页面严格按配置显示
- **用户体验**: 页面字段显示顺序现在完全遵循配置文件设置，提高配置一致性
- **影响范围**: 子因子基本信息显示区域

#### 修复表格数字精度丢失问题
- **修复内容**: 
  - 解决表格中数字数据显示时精度丢失的问题
  - 修复大数字可能显示为科学计数法的问题
- **技术实现**:
  - 修改`display_data_table`方法中的数字格式化逻辑
  - 对整数类型直接转换为字符串，保持原始值
  - 对浮点数类型使用`f"{value:.10g}"`格式化，保留足够精度并避免科学计数法
- **用户体验**: 表格中的数字显示保持原始精度，提高数据准确性
- **影响范围**: 所有数据表格的数字显示

### ⚡ 性能优化

#### 进一步优化实时搜索响应速度
- **改进内容**: 
  - 将实时搜索延迟时间从100毫秒进一步优化至50毫秒
  - 响应速度提升50%，提供更加流畅的实时搜索体验
  - 保持搜索防抖机制，确保性能稳定
- **技术实现**:
  - 修改`SubFactorDetailView`类中`on_search_change`方法的延迟参数
  - 从`self.frame.after(100, self._delayed_search_filter)`优化为`self.frame.after(50, self._delayed_search_filter)`
  - 更新相关注释说明，强调极速响应的搜索体验
- **用户体验**: 用户输入搜索内容后仅需50毫秒即可看到搜索结果，交互更加流畅
- **影响范围**: 所有数据表格的实时搜索功能

## [v1.2.11] - 2025-01-22

### 🐛 问题修复

#### 修复数据表格复制功能
- **修复内容**: 
  - 安装缺失的tksheet依赖库，解决复制功能无法正常工作的问题
  - 修复tksheet返回set类型数据导致的索引访问错误
  - 优化选中行和选中单元格的获取逻辑，提高复制功能的稳定性
- **技术实现**:
  - 在requirements.txt中添加tksheet>=7.0.0依赖
  - 修改`copy_row_as_text`、`copy_row_as_json`、`copy_row_as_markdown`方法
  - 将set类型转换为list类型进行索引访问
  - 增强异常处理和错误追踪功能
- **用户体验**: 右键复制功能恢复正常，支持文本、JSON、Markdown三种格式复制
- **影响范围**: 所有数据表格的右键复制功能

### 🔧 功能调整

#### 移除复制单元格功能
- **调整内容**: 
  - 从右键菜单中移除"复制单元格值"选项
  - 简化右键菜单，只保留行级别的复制功能
  - 移除相关的菜单分隔符
- **技术实现**:
  - 修改`setup_table_events`方法，移除单元格复制菜单项
  - 保留`copy_current_cell_value`方法代码以备后续需要
- **用户体验**: 右键菜单更加简洁，专注于行级别的数据复制
- **影响范围**: 数据表格右键菜单

#### 移除复制操作的搜索提示
- **调整内容**: 
  - 移除复制操作后在搜索过滤框显示的临时提示信息
  - 保持搜索框的默认"⚡ 实时搜索"提示
  - 复制功能本身和终端日志输出保持不变
- **技术实现**:
  - 在`copy_row_as_text`、`copy_row_as_json`、`copy_row_as_markdown`方法中移除search_tooltip相关代码
  - 保留print日志输出用于调试确认
- **用户体验**: 搜索框不再显示复制成功的临时提示，界面更加简洁
- **影响范围**: 数据表格复制功能的用户界面反馈

## [v1.2.10] - 2025-01-21

### ⚡ 性能优化

#### 优化实时搜索响应速度
- **改进内容**: 
  - 将实时搜索延迟时间从1200毫秒优化至100毫秒
  - 显著提升搜索响应速度，提供近乎实时的搜索体验
  - 保持搜索防抖机制，避免过度频繁的搜索请求
- **技术实现**:
  - 修改`SubFactorDetailView`类中`on_search_change`方法的延迟参数
  - 从`self.frame.after(1200, self._delayed_search_filter)`优化为`self.frame.after(100, self._delayed_search_filter)`
  - 更新相关注释说明，强调极速响应的搜索体验
- **用户体验**: 用户输入搜索内容后仅需100毫秒即可看到搜索结果，大幅提升交互流畅性
- **影响范围**: 所有数据表格的实时搜索功能

## [v1.2.9] - 2025-01-21

### ✨ 新增功能

#### 添加Markdown格式复制功能
- **新增内容**: 
  - 在表格右键菜单中新增"复制为Markdown"选项
  - 支持将选中的表格行数据复制为标准Markdown表格格式
  - 包含完整的表头和数据行，支持在文档、Wiki等平台直接使用
- **技术实现**:
  - 在`SubFactorDetailView`类中添加`copy_row_as_markdown`方法
  - 实现表格数据到Markdown格式的转换逻辑
  - 修复`show_table_context_menu`方法中临时菜单缺少Markdown选项的问题
  - 添加调试日志以便功能验证和问题排查
- **用户体验**: 用户可以方便地将表格数据复制为Markdown格式，提高数据分享和文档编写效率
- **影响范围**: 所有数据表格的右键菜单功能

## [v1.2.8] - 2025-01-20

### 🔄 组件升级

#### 替换表格组件为tksheet
- **改进内容**: 
  - 将ttk.Treeview表格组件替换为tksheet组件
  - 实现完整的表格网格线显示
  - 保留交替行颜色效果
  - 增强表格的整体视觉效果
- **技术实现**:
  - 添加tksheet库依赖
  - 修改`view.py`中`SubFactorDetailView`类的表格初始化代码
  - 重构`display_data_table`方法以适配tksheet API
  - 更新事件处理方法，包括排序、行选择和双击事件
- **用户体验**: 表格显示更加专业，网格线清晰可见，提高数据可读性和专业感
- **影响范围**: 所有数据表格显示区域

## [v1.2.7] - 2025-01-19

### 🎨 界面优化

#### 添加表格交替行颜色
- **改进内容**: 
  - 为数据表格添加交替行颜色效果，使表格行更加清晰可辨
  - 实现表格排序后仍保持交替行颜色效果
  - 增强表格数据的视觉层次感
- **技术实现**:
  - 修改`view.py`中`SubFactorDetailView`类的`display_data_table`方法
  - 添加`tag_configure`配置交替行背景色
  - 更新`sort_by_column`方法，确保排序后重新应用交替行颜色
- **用户体验**: 表格数据行更加清晰，提高数据可读性和浏览效率
- **影响范围**: 所有数据表格显示区域

## [v1.2.6] - 2025-01-18

### 🎨 界面优化

#### 添加数据表格边框
- **改进内容**: 
  - 为数据表格添加边框，使表格结构更加清晰
  - 增强表格标题和单元格的视觉分隔效果
  - 统一普通表格和科技风格表格的边框样式
- **技术实现**:
  - 修改`view.py`中表格样式配置
  - 为`Treeview`和`Treeview.Heading`添加边框和浮雕效果
  - 为`Tech.Treeview`增强单元格边框显示
- **用户体验**: 表格数据结构更加清晰，提高数据可读性和专业感
- **影响范围**: 所有数据表格显示区域

## [v1.2.5] - 2025-01-17

### 🎨 界面优化

#### 调整子因子基本信息字段布局
- **改进内容**: 
  - 将子因子基本信息区域的字段显示从每行6个字段调整为每行4个字段
  - 优化字段间距和布局，提高信息可读性
- **技术实现**:
  - 修改`view.py`中`SubFactorDetailView`类的`display_basic_info`方法
  - 将`fields_per_row`参数从6改为4
  - 保持Grid布局的等宽分布和对齐效果
- **用户体验**: 减少每行字段数量，增加字段显示宽度，提高信息可读性和查看舒适度
- **影响范围**: 子因子基本信息显示区域

## [v1.2.4] - 2025-01-16

### 🎨 界面优化

#### 统一界面字体颜色
- **改进内容**: 
  - 统一整个界面的字体颜色，消除灰色和黑色混用的情况
  - 将普通文本统一为黑色(#000000)，特殊状态文本(如N/A、待加载)统一为深灰色(#333333)
  - 将提示信息和操作反馈统一为相应颜色(深灰色#333333、深绿色#006600)
- **技术实现**:
  - 修改`view.py`中`DocumentInfoView`和`SubFactorDetailView`类中的字体颜色设置
  - 统一搜索提示、复制操作反馈等文本的颜色
  - 保持颜色一致性，提高界面美观度
- **用户体验**: 界面颜色更加统一和谐，提升视觉体验和专业感
- **影响范围**: 整个应用界面的文本显示

## [v1.2.3] - 2025-01-15

### 🎨 界面优化

#### 优化单据基本信息字段显示顺序
- **改进内容**: 
  - 调整单据基本信息字段的显示顺序，使其与配置文件中的`document_info_fields`顺序保持一致
  - 移除基于优先级的字段排序逻辑，改为完全按照配置顺序显示
- **技术实现**:
  - 修改`view.py`中`_create_field_display_layout`方法的字段排序逻辑
  - 从配置管理器获取`document_info_fields`的顺序并应用到显示逻辑中
- **用户体验**: 使界面显示与配置文件保持一致，提高用户配置的可预测性和直观性
- **影响范围**: 单据基本信息显示区域

## [v1.2.2] - 2025-01-14

### 🎨 界面优化

#### 统一基本信息字段布局
- **改进内容**: 
  - 将单据基本信息区域的字段显示从每行4个字段调整为每行6个字段
  - 调整子因子基本信息布局，与单据基本信息保持一致，采用每行6个字段的Grid布局
- **技术实现**:
  - 修改 `view.py` 中 `_create_field_display_layout` 方法的 `fields_per_row` 参数从4改为6
  - 重构 `SubFactorDetailView` 类的 `display_basic_info` 方法，使用与 `DocumentInfoView` 一致的Grid布局
  - 移除子因子基本信息区域的固定高度限制，改为自适应内容高度
  - 保持Grid布局的等宽分布和对齐效果
- **用户体验**: 在相同空间内显示更多字段信息，提高信息密度和查看效率，统一界面风格
- **影响范围**: 单据基本信息和子因子基本信息显示区域

#### 修复字段显示布局问题
- **问题描述**: 加载数据后仅显示"业务代码"一个字段，其他字段未显示
- **根本原因**: Canvas滚动容器与Grid布局混合使用导致布局冲突
- **解决方案**:
  - 移除 `display_info` 和 `show_default_info` 方法中的Canvas滚动区域
  - 简化布局逻辑，直接在主框架上使用Grid布局
  - 修复悬停效果中引用不存在变量的错误
- **技术改进**: 统一使用Grid布局，避免Pack和Grid布局混用问题

### 🔧 代码优化
- 简化字段显示布局代码结构
- 提高布局稳定性和可维护性
- 优化字段对齐算法

---

## [v1.2.1] - 2025-01-13

### 🐛 Bug修复

#### 修复启动时表格字段显示问题
- **问题描述**: 程序启动时数据表格中没有显示配置的字段，只有加载数据后才显示
- **根本原因**: 
  - 视图层在DataFrame为空时不显示任何列标题
  - 控制器层基于空的df.columns生成显示名称映射，导致映射为空
- **解决方案**:
  - 修改 `view.py` 中的 `display_data_table` 方法，添加 `columns_config` 参数
  - 当DataFrame为空但有列配置时，显示配置的列标题和中文名称
  - 修改 `controller.py` 中的列名映射逻辑，使用配置的 `columns` 而不是 `df.columns`
- **影响范围**: 视图层和控制器层
- **用户体验**: 启动时即可看到表格结构和字段含义，无需等待数据加载

### 📝 文档更新
- 更新 README.md 故障排除部分，添加表格字段显示问题的解决方案
- 更新 development_plan.md 开发计划，记录此次修复的详细信息
- 创建 CHANGELOG.md 文件，建立版本更新记录机制

### 🔧 技术改进
- 优化表格初始化逻辑，支持空数据状态下的字段显示
- 改进列宽计算算法，兼容空数据和有数据两种状态
- 增强数据表格的健壮性和用户体验

---

## [v1.2.0] - 2025-01-12

### ✨ 新功能
- 实现配置管理界面，支持可视化配置编辑
- 添加搜索过滤功能，支持实时数据表格过滤
- 实现数据复制功能，支持单元格和整行JSON复制

### 🐛 Bug修复
- 修复控制台AttributeError错误
- 优化内存使用和性能
- 完善异常处理和日志系统

### 📚 文档
- 完善开发设计文档
- 更新用户使用说明
- 添加故障排除指南

---

## [v1.1.0] - 2025-01-10

### ✨ 新功能
- 实现基础的数据加载和显示功能
- 支持层级数据结构展示
- 实现因子分类和子因子管理

### 🎨 界面优化
- 采用微软雅黑字体，提升中文显示效果
- 优化界面布局和颜色搭配
- 实现现代化的UI设计

---

## [v1.0.0] - 2025-01-08

### 🎉 首次发布
- 基础项目架构搭建
- 实现MVC设计模式
- 基础数据处理功能
- Tkinter界面框架